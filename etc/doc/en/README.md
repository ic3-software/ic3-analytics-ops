# Overview

The project is still in its very **early days** and, it currently aims at providing the building blocks
from which higher level tests will be implemented. The main entry point is
the [shell](../../../src/main/java/ic3/analyticsops/shell/AOShell.java) class
that is running a test.

## Test

A [test](../../../src/main/java/ic3/analyticsops/test/AOTest.java) is made of
[actors](../../../src/main/java/ic3/analyticsops/test/AOActor.java) that are running
a list of [tasks](../../../src/main/java/ic3/analyticsops/test/AOTask.java). A task
can load a schema, open a dashboard, execute an MDX statement, etc... and can have
one or more [assertions](../../../src/main/java/ic3/analyticsops/test/assertion/AOAssertion.java)
to ensure the expected results.

A test can be defined as a `JSON5` file. The following `JSON5` features are supported :

```json5
{
  // comments
  unquoted: "and you can quote me on that",
  singleQuotes: 'I can use "double quotes" here',
  lineBreaks: "Look, Mom! \
No \\n's!",
  "backwardsCompatible": "with JSON",
}
```

Here is a sample [file](../../tests/smoke.test.json5) creating a test with all the available tasks.

## Tasks

Here is the list of the available tasks. Please refer to the code of each task for more details
about their configuration and assertions.

### Server Management

- `ServerStatus` : Returns some information about the icCube server (requires an icCube server v8.4.10 for the version
  info.).
- `ClearResultCache` : Clear the MDX result cache used for the MDX queries sent by the dashboards.

### Schema Management

- `LoadedSchemas` : retrieve some information about a loaded schema.
- `SchemaInfo` : retrieve some information about a deployed schema.

- `LoadSchema`: fully (or incrementally) load a schema.
- `RestoreSchemaBackup`: load a schema by restoring a backup.
- `DeleteSchemaBackup`: delete a backup.
- `RestoreSchemaSnapshot`: load a schema by restoring a snapshot.
- `UnloadSchema`: unload a schema.

### MDX Execution

Note the execution of the MDX statement as specified in these tasks are **not using the server MDX
result cache**.

- `ExecuteMdx` : execute an MDX statement and assert its result using another equivalent MDX statement.
- `MDXes` : execute a list of MDX statements and assert their results using a list of previously generated results.
- `GenerateMDXes` : used for generating the expected results of the task `MDXes`.

### Dashboards

Note the execution of the MDX statements as generated by these tasks are **using the server MDX
result cache**.

- `OpenReport` : open a report using a local `Chrome` instance.
- `PrintReport` : request the icCube server to print a report (requires an icCube server v8.4.10).

## Assertions

Each running task can have one or more assertions to ensure expected results. Here are some details about MDX
assertions. Please refer to the code of each task for more details about their assertions.

### Task: ExecuteMDX

The `ExecuteMdx` task executes an MDX statement and assert its result using another equivalent MDX statement.
For example, you can assert that a `TopCount` is behaving exactly like a `Head(Order())` combination as following :

```
{
  action: "MDX",
  schema: "Sales",
  // The actual MDX statement
  statement: "select TopCount( [Customers].[Geography].[Region], 3, [Measures].[Count] ) on 0 from [Sales]",
  assertions: [
    {
      equals: {
        // The expected MDX statement
        statement: "select Head( Order( [Customers].[Geography].[Region], [Measures].[Count], BDESC ), 3) on 0 from [Sales]"
      }
    }
  ]
}
```

When comparing the MDX results, the following logics are available :

- `equals` : the both results are strictly the same.
- `cellEquals` : only the content of the cells are the same : member columns, name of the columns are ignored.
- `statementOnError` : the result must generate an expected error.
- `cellOnError` : the result must generate a single cell with an expected error.

### Task: MDXes

The `ExecuteMdx` task executes a list of MDX statements and assert their results using a list of previously
generated results. For example, the following :

```
{
  action: "MDXes",
  data: "data/sales",
  schema: "Sales"
}
```

is executing the MDX statements as defined in the `data` folder filtering the files using the `sales` pattern :

```
/data
  /sales-0.mdx.txt
  /sales-0.mdx.json(.zip)
  /sales-1.mdx.txt
  /sales-1.mdx.json(.zip)
```

The files `.mdx.txt` contains the MDX statement and the `mdx.json` contains the result as generated by the task
`GenerateMDXes`. The result files can be zipped (default format when using `GenerateMDXes`).

Note that the MDX statement can contain a delta value for asserting the floating point values :

```
//delta:1e-5

SELECT ... FROM ...
```

_
